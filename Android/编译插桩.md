# 编译插桩

## 技术实现

    Java文件

        APT,AndroidAnnotation 代码生成的场景,他们生成的都是Java文件

    字节码(Bytecode)

        对于代码监控,代码修改以及代码分析三个场景,一般采用操作字节码的方式,可以操作'.class'的Java字节码,也可以操作'.dex'的Dalvik字节码
        相对于Java文件的方式,字节码操作更加强大,应用场景也更广,但是它使用的复杂度更高

### AspectJ

#### 介绍

    内部通过字节码处理技术实现代码注入


#### 使用方法

    1. 为方法类添加 @Aspect 注解
    2. 在对应方法中添加 @After("execution(* [类路径 ])")

``` java
@Aspect
public class ActivityAspect {

     @Before("execution(* android.app.Activity.onCreate(..))")
    public void onCreateMethodBefore(org.aspectj.lang.JoinPoint joinPoint) throws Throwable {
        System.out.println("Update onCreateMethod_Before Point = " + joinPoint.getSignature());
    }
    @After("execution(* android.app.Activity.onCreate(..))")
    public void onCreateMethodAfter(org.aspectj.lang.JoinPoint joinPoint) throws Throwable {
        System.out.println("Update onCreateMethod_After Point = " + joinPoint.getSignature());
    }
}
```

运行结果如下图 已插入成功

``` js
    com.update.aspectjxdemo I/System.out: Update onCreateMethod_Before Point = void com.update.aspectjxdemo.MainActivity.onCreate(Bundle)
    Update onCreateMethod_Before Point = void android.support.v7.app.AppCompatActivity.onCreate(Bundle)
    Update onCreateMethod_Before Point = void android.support.v4.app.FragmentActivity.onCreate(Bundle)
    Update onCreateMethod_Before Point = void android.support.v4.app.SupportActivity.onCreate(Bundle)
    Update onCreateMethod_After Point = void android.support.v4.app.SupportActivity.onCreate(Bundle)
    Update onCreateMethod_After Point = void android.support.v4.app.FragmentActivity.onCreate(Bundle)
    Update onCreateMethod_After Point = void android.support.v7.app.AppCompatActivity.onCreate(Bundle)
    com.update.aspectjxdemo I/System.out: Update onCreateNow 
    Update onCreateMethod_After Point = void com.update.aspectjxdemo.MainActivity.onCreate(Bundle)
```

![](https://ws4.sinaimg.cn/large/006tKfTcly1g0otuq7842j310u0fojvz.jpg)

适用场景:

    无痕埋点,打印日志之类的都可以这样实现,
